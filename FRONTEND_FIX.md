# ğŸ”§ å‰ç«¯åå¥½è°ƒæ•´ä¿®å¤è¯´æ˜

## é—®é¢˜è¯Šæ–­

æ‚¨é‡åˆ°çš„é—®é¢˜ï¼šè¾“å…¥"æˆ‘è¦æ¬¢åƒè¾£çš„"åï¼Œåç«¯æ­£ç¡®è¯†åˆ«å¹¶æ›´æ–°äº†åå¥½ï¼Œä½†å‰ç«¯æ˜¾ç¤º"ç³Ÿäº†ï¼å¨æˆ¿èµ·ç«äº†"çš„é”™è¯¯æ¶ˆæ¯ã€‚

### æ ¹æœ¬åŸå› 
- åç«¯è¿”å›çš„æ˜¯åå¥½è°ƒæ•´ç¡®è®¤æ¶ˆæ¯ï¼ˆæ–‡æœ¬ï¼‰
- å‰ç«¯æœŸæœ›çš„æ˜¯èœè°±JSONæ ¼å¼
- å‰ç«¯æ— æ³•è§£ææ–‡æœ¬æ¶ˆæ¯ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯

## ä¿®å¤å†…å®¹

### 1. åç«¯ä¿®æ”¹ (`server/index.js`)
æ·»åŠ  `type: 'preference_update'` æ ‡è¯†ï¼š
```javascript
return res.json({
  type: 'preference_update',  // æ–°å¢ï¼šæ ‡è¯†å“åº”ç±»å‹
  choices: [{
    message: {
      role: 'assistant',
      content: `${confirmationMsg}\n\nğŸ’¡ ${preferenceResult.explanation}`
    }
  }],
  updatedProfile: updatedProfile  // æ–°å¢ï¼šè¿”å›æ›´æ–°åçš„ç”»åƒ
});
```

### 2. å‰ç«¯ä¿®æ”¹ (`services/geminiService.ts`)
åœ¨ `callDeepSeek` å‡½æ•°ä¸­æ£€æµ‹åå¥½è°ƒæ•´å“åº”ï¼š
```typescript
const data = await response.json();

// æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯åå¥½è°ƒæ•´å“åº”
if (data.type === 'preference_update') {
  const message = data.choices?.[0]?.message?.content || 'åå¥½å·²æ›´æ–°';
  throw new Error(`PREFERENCE_UPDATE:${message}`);
}

return data.choices[0].message.content;
```

### 3. å‰ç«¯ä¿®æ”¹ (`App.tsx`)
åœ¨é”™è¯¯å¤„ç†ä¸­è¯†åˆ«åå¥½è°ƒæ•´å“åº”ï¼š
```typescript
} catch (err: any) {
  const errorMsg = err.message || "æœªçŸ¥é”™è¯¯";
  
  // æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯åå¥½è°ƒæ•´å“åº”
  if (errorMsg.startsWith('PREFERENCE_UPDATE:')) {
    const message = errorMsg.replace('PREFERENCE_UPDATE:', '');
    showToast(message);  // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    setError(null);      // æ¸…é™¤é”™è¯¯çŠ¶æ€
  } else {
    setError(`ç³Ÿäº†ï¼å¨æˆ¿èµ·ç«äº†...`);  // æ˜¾ç¤ºçœŸæ­£çš„é”™è¯¯
  }
}
```

## éƒ¨ç½²æ­¥éª¤

```bash
# 1. é‡æ–°æ„å»ºå‰ç«¯
npm run build

# 2. é‡å¯å®¹å™¨
docker compose down
docker compose up -d --build

# 3. æµ‹è¯•
# æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨è¾“å…¥æ¡†è¾“å…¥ï¼š"æˆ‘æ›´å–œæ¬¢å·èœ"
# åº”è¯¥çœ‹åˆ°ç»¿è‰²çš„æˆåŠŸæç¤ºï¼š"âœ… å·²ä¸ºæ‚¨æ˜æ˜¾å¢åŠ ã€å·èœã€‘åå¥½..."
```

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œå½“ç”¨æˆ·è¾“å…¥åå¥½è°ƒæ•´è¯­å¥æ—¶:
- âœ… ä¸å†æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
- âœ… æ˜¾ç¤ºç»¿è‰²çš„æˆåŠŸæç¤ºï¼ˆToastï¼‰
- âœ… ç”¨æˆ·ç”»åƒæƒé‡åœ¨åå°æ›´æ–°
- âœ… ä¸‹æ¬¡æ¨èä¼šè€ƒè™‘æ–°çš„åå¥½

## æµ‹è¯•ç”¨ä¾‹

è¯•è¯•è¿™äº›åå¥½è°ƒæ•´è¯­å¥ï¼š
1. "æˆ‘æ›´å–œæ¬¢å·èœ"
2. "ä¸è¦é‚£ä¹ˆè¾£"
3. "å¤šä¸€äº›æµ·é²œ"
4. "å°‘æ²¹ç‚¸ï¼Œå¤šæ¸…è’¸"
5. "æˆ‘æƒ³åƒå¥åº·çš„"

æ¯ä¸ªéƒ½åº”è¯¥å¾—åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯é”™è¯¯ï¼
